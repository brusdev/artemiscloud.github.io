<!doctype html><html lang=en-us><head>
<meta charset=utf-8>
<title>The Broker Operator</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5">
<meta name=description content="ArtemisCloud.io is a collection of container images that provide a way to deploy the Apache ActiveMQ Artemis Broker on Kubernetes.">
<meta name=author content="Themefisher">
<meta name=generator content="Hugo 0.92.0">
<link rel=stylesheet href=/plugins/bootstrap/bootstrap.min.css>
<link rel=stylesheet href=/plugins/themify-icons/themify-icons.css>
<link rel=stylesheet href=/plugins/slick/slick.css>
<link href=/scss/style.min.css rel=stylesheet media=screen>
<link rel="shortcut icon" href=/favicon.png type=image/x-icon>
<link rel=icon href=/favicon.png type=image/x-icon>
<meta property="og:image" content="https://artemiscloud.io/favicon.png">
<meta property="og:title" content="The Broker Operator">
<meta property="og:description" content="ArtemisCloud.io is a collection of container images that provide a way to deploy the Apache ActiveMQ Artemis Broker on Kubernetes.">
<meta property="og:type" content="website">
<meta property="og:url" content="/documentation/operator/">
</head><body>
<header class=navigation>
<div class=container>
<nav class="navbar navbar-expand-lg navbar-light bg-transparent">
<a class=navbar-brand href=/>
</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i>
</button>
<div class="collapse navbar-collapse text-center" id=navigation>
<ul class="navbar-nav mx-auto">
<li class=nav-item>
<a class=nav-link href=/>Home</a>
</li>
<li class=nav-item>
<a class=nav-link href=/blog>Blog</a>
</li>
<li class=nav-item>
<a class=nav-link href=/documentation>Documentation</a>
</li>
<li class=nav-item>
<a class=nav-link href=/releases>Releases</a>
</li>
<li class=nav-item>
<a class=nav-link href=/community>Community</a>
</li>
</ul>
</div>
</nav>
</div>
</header>
<section class="section pb-0">
<div class="container text-center">
<h1 class=display-3>The Broker Operator</h1>
</div>
</section>
<div class=body style=display:flex>
<div class=nav-container data-component=artemiscloud-docs data-version=dev>
<aside class=nav>
<div class=panels>
<div class="nav-panel-menu is-active" data-panel=menu>
<nav class=nav-menu>
<ul>
<li class=nav-item data-depth=0>
<span class=nav-text>Introduction</span>
<ul>
<li class=nav-item data-depth=1>
<a class=nav-link href=/documentation/introduction#Welcome>Welcome</a>
</li>
</ul>
</ul>
<ul>
<li class=nav-item data-depth=0>
<span class=nav-text>The Broker Operator</span>
<ul>
<li class=nav-item data-depth=1>
<a class=nav-link href=/documentation/operator#Overview>Overview</a>
</li>
</ul>
<ul>
<li class=nav-item data-depth=1>
<a class=nav-link href=/documentation/operator#Installing%20The%20Operator>Installing The Operator</a>
</li>
</ul>
</ul>
<ul>
<li class=nav-item data-depth=0>
<span class=nav-text>Reference</span>
<ul>
<li class=nav-item data-depth=1>
<a class=nav-link href=/documentation/reference#Custom%20Resource%20Configuration%20Reference>Custom Resource Configuration Reference</a>
</li>
</ul>
</ul>
</nav>
</div>
</div>
</aside>
</div>
<main>
<div class=content style=display:flex>
<article class=doc>
<div class=sect1>
<section id=Overview>
<h2 id=overview-of-the-artemiscloud-operator-custom-resource-definitions>Overview of the ArtemisCloud Operator Custom Resource Definitions</h2>
<p>In general, a Custom Resource Definition (CRD) is a schema of configuration items that you can modify for a custom Kubernetes
object deployed with an Operator. By creating a corresponding Custom Resource (CR) instance, you can specify values for
configuration items in the CRD. If you are an Operator developer, what you expose through a CRD essentially becomes the
API for how a deployed object is configured and used. You can directly access the CRD through regular HTTP curl commands,
because the CRD gets exposed automatically through Kubernetes.</p>
<p><em><strong>Main broker CRD</strong></em></p>
<p>You deploy a CR instance based on this CRD to create and configure a broker deployment</p>
<p>The <strong>broker_activemqartemis_crd</strong> file in the <strong>crds</strong> directory of the Operator installation archive (Kubernetes CLI installation method)</p>
<p><em><strong>Address CRD</strong></em></p>
<p>You deploy a CR instance based on this CRD to create addresses and queues for a broker deployment.</p>
<p>The <strong>broker_activemqartemisaddress</strong>_crd file in the <strong>crds</strong> directory of the Operator installation archive (Kubernetes CLI installation method)</p>
<p><em><strong>Scaledown CRD</strong></em></p>
<p>The Operator automatically creates a CR instance based on this CRD when instantiating a scaledown controller for message migration.</p>
<p>The <strong>broker_activemqartemisscaledown_crd</strong> file in the <strong>crds</strong> directory of the Operator installation archive (Kubernetes CLI installation method)</p>
<h3 id=additional-resources>Additional resources</h3>
<p>To learn how to install the ActiveMQ Artemis Operator (and all included CRDs) using:</p>
<p>The Kubernetes CLI, see <a href=#operator_installing>Installing the Operator</a></p>
<p>For complete configuration references to use when creating CR instances based on the main broker and address CRDs, see:</p>
<p>Broker Custom Resource configuration reference</p>
<p>Address Custom Resource configuration reference</p>
</section>
<section id="Installing The Operator">
<h2 id=installing-the-operator-using-the-cli>Installing the Operator using the CLI</h2>
<p>The procedures in this section show how to use the Kubernetes command-line interface (CLI) to install and deploy the latest
version of the Operator for ArtemisCloud in a given Kubernetes project. In subsequent procedures, you use this Operator
to deploy some broker instances.</p>
<h3 id=getting-the-operator-code>Getting the Operator code</h3>
<p>This procedure shows how to access and prepare the code you need to install the latest version of the Operator for ArtemisCloud .</p>
<p>Procedure
Download the latest version of the Operator from <a href=https://github.com/artemiscloud/activemq-artemis-operator/archive/v0.18.1.zip target=_blank>https://github.com/artemiscloud/activemq-artemis-operator/archive/v0.18.1.zip</a></p>
<p>When the download has completed, move the archive to your chosen installation directory. The following example moves the archive to a directory called ~/broker/operator.</p>
<p>$ mkdir ~/broker/operator
$ mv activemq-artemis-operator-0.18.1.zip ~/broker/operator
In your chosen installation directory, extract the contents of the archive. For example:</p>
<p>$ cd ~/broker/operator
$ unzip activemq-artemis-operator-0.18.1.zip
Switch to the directory that was created when you extracted the archive. For example:</p>
<p>$ cd activemq-artemis-operator
Specify the project in which you want to install the Operator. You can create a new project or switch to an existing one.</p>
<p>Create a new namespace:</p>
<p>$ kubectl create namespace <project-name>
Or, switch to an existing namespace:</p>
<p>$ kubectl config set-context $(kubectl config current-context) &ndash;namespace= <project-name>
Specify a service account to use with the Operator.</p>
<p>In the deploy directory of the Operator archive that you extracted, open the service_account.yaml file.</p>
<p>Ensure that the kind element is set to ServiceAccount.</p>
<p>In the metadata section, assign a custom name to the service account, or use the default name. The default name is activemq-artemis-operator.</p>
<p>Create the service account in your project.</p>
<p>$ kubectl create -f deploy/service_account.yaml
Specify a role name for the Operator.</p>
<p>Open the role.yaml file. This file specifies the resources that the Operator can use and modify.</p>
<p>Ensure that the kind element is set to Role.</p>
<p>In the metadata section, assign a custom name to the role, or use the default name. The default name is activemq-artemis-operator.</p>
<p>Create the role in your project.</p>
<p>$ kubectl create -f deploy/role.yaml
Specify a role binding for the Operator. The role binding binds the previously-created service account to the Operator role, based on the names you specified.</p>
<p>Open the role_binding.yaml file. Ensure that the name values for ServiceAccount and Role match those specified in the service_account.yaml and role.yaml files. For example:</p>
<p>metadata:
name: activemq-artemis-operator
subjects:
kind: ServiceAccount
name: activemq-artemis-operator
roleRef:
kind: Role
name: activemq-artemis-operator
Create the role binding in your project.</p>
<p>$ kubectl create -f deploy/role_binding.yaml
In the procedure that follows, you deploy the Operator in your project.</p>
<h2 id=deploying-the-operator-using-the-cli>Deploying the Operator using the CLI</h2>
<p>The procedure in this section shows how to use the Kubernetes command-line interface (CLI) to deploy the latest version of the Operator for ArtemisCloud in your Kubernetes project.</p>
<p>Prerequisites
You must have already prepared your Kubernetes project for the Operator deployment. See Getting the Operator code.</p>
<p>If you intend to deploy brokers with persistent storage and do not have container-native storage in your Kubernetes cluster, you need to manually provision Persistent Volumes (PVs) and ensure that they are available to be claimed by the Operator. For example, if you want to create a cluster of two brokers with persistent storage (that is, by setting persistenceEnabled=true in your Custom Resource), you need to have two PVs available. By default, each broker instance requires storage of 2 GiB.</p>
<p>If you specify persistenceEnabled=false in your Custom Resource, the deployed brokers uses ephemeral storage. Ephemeral storage means that that every time you restart the broker Pods, any existing data is lost.</p>
<p>Procedure
Specify the project in which you want to install the Operator. You can create a new project or switch to an existing one.</p>
<p>Create a new namespace:</p>
<p>$ kubectl create namespace <project-name>
Or, switch to an existing namespace:</p>
<p>$ kubectl config set-context $(kubectl config current-context) &ndash;namespace= <project-name>
Switch to the directory that was created when you previously extracted the Operator installation archive. For example:</p>
<p>$ cd ~/broker/operator/amq-broker-operator&ndash;ocp-install-examples
Deploy the CRDs that are included with the Operator. You must install the CRDs in your Kubernetes cluster before deploying and starting the Operator.</p>
<p>Deploy the main broker CRD.</p>
<p>$ kubectl create -f deploy/crds/broker_activemqartemis_crd.yaml
Deploy the address CRD.</p>
<p>$ kubectl create -f deploy/crds/broker_activemqartemisaddress_crd.yaml
Deploy the scaledown controller CRD.</p>
<p>$ kubectl create -f deploy/crds/broker_activemqartemisscaledown_crd.yaml
In the deploy directory of the Operator archive that you downloaded and extracted, open the operator.yaml file. Ensure that the value of the spec.containers.image property is set to the latest Operator image for ActiveMQ Artemis , as shown below.</p>
<p>spec:
template:
spec:
containers:
image: quay.io/artemiscloud/activemq-artemis-operator:0.18.1
Deploy the Operator.</p>
<p>$ kubectl create -f deploy/operator.yaml
In your Kubernetes project, the Operator starts in a new Pod.</p>
<p>In the Kubernetes web console, the information on the Events tab of the Operator Pod confirms that Kubernetes has deployed the Operator image that you specified, has assigned a new container to a node in your Kubernetes cluster, and has started the new container.</p>
<p>In addition, if you click the Logs tab within the Pod, the output should include lines resembling the following:</p>
<p>&mldr;
{&ldquo;level&rdquo;:&ldquo;info&rdquo;,&ldquo;ts&rdquo;:1553619035.8302743,&ldquo;logger&rdquo;:&ldquo;kubebuilder.controller&rdquo;,&ldquo;msg&rdquo;:&ldquo;Starting Controller&rdquo;,&ldquo;controller&rdquo;:&ldquo;activemqartemisaddress-controller&rdquo;}
{&ldquo;level&rdquo;:&ldquo;info&rdquo;,&ldquo;ts&rdquo;:1553619035.830541,&ldquo;logger&rdquo;:&ldquo;kubebuilder.controller&rdquo;,&ldquo;msg&rdquo;:&ldquo;Starting Controller&rdquo;,&ldquo;controller&rdquo;:&ldquo;activemqartemis-controller&rdquo;}
{&ldquo;level&rdquo;:&ldquo;info&rdquo;,&ldquo;ts&rdquo;:1553619035.9306898,&ldquo;logger&rdquo;:&ldquo;kubebuilder.controller&rdquo;,&ldquo;msg&rdquo;:&ldquo;Starting workers&rdquo;,&ldquo;controller&rdquo;:&ldquo;activemqartemisaddress-controller&rdquo;,&ldquo;worker count&rdquo;:1}
{&ldquo;level&rdquo;:&ldquo;info&rdquo;,&ldquo;ts&rdquo;:1553619035.9311671,&ldquo;logger&rdquo;:&ldquo;kubebuilder.controller&rdquo;,&ldquo;msg&rdquo;:&ldquo;Starting workers&rdquo;,&ldquo;controller&rdquo;:&ldquo;activemqartemis-controller&rdquo;,&ldquo;worker count&rdquo;:1}
The preceding output confirms that the newly-deployed Operator is communicating with Kubernetes, that the controllers for the broker and addressing are running, and that these controllers have started some workers.</p>
<p>It is recommended that you deploy only a single instance of the ActiveMQ Artemis Operator in a given Kubernetes project. Setting the replicas element of your Operator deployment to a value greater than 1, or deploying the Operator more than once in the same project is not recommended.</p>
</section>
</div>
</article>
</div>
</main>
</div>
<footer class="section pb-0">
<div class=container>
<div class=row>
<div class="col-md-3 col-sm-3 mb-10">
<ul class="list-inline social-icons">
<li class=list-inline-item><a href=https://twitter.com/artemiscloudio><i class=ti-twitter-alt></i></a></li><li class=list-inline-item>twitter</li>
<li class=list-inline-item><a href=https://github.com/ArtemisCloud><i class=ti-github></i></a></li><li class=list-inline-item>github</li>
</ul>
</div>
<div class="col-md-3 col-sm-3 mb-10">
<a href=https://www.redhat.com/ target=_blank><img width=250px src=/images/Logo-Red_Hat-Sponsored_By-A-Standard-RGB.png></a>
</div>
<div class="col-md-6 col-sm-6">
<div class=copyright>
<p>Apache, Apache ActiveMQ Artemis,Artemis and associated open source project names are trademarks of the <a href=https://www.apache.org/>Apache Software Foundation</a>.</p>
</div>
</div>
</div>
</div>
</footer>
<script src=/plugins/jQuery/jquery.min.js></script>
<script src=/plugins/bootstrap/bootstrap.min.js></script>
<script src=/plugins/slick/slick.min.js></script>
<script src=/js/script.min.js></script></body>
</html>